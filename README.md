# Karavel Container Platform E2E Testing

This repository contains the E2E test suite used to validate Karavel Container Platform instances. It also hosts the 
infrastructure-as-code definitions necessary to spin up the test infrastructure on supported cloud providers.

The test suite is written using [the Kubernetes E2E test framework](https://github.com/kubernetes-sigs/e2e-framework) 
and runs as a [Sonobuoy plugin](https://sonobuoy.io/docs/v0.54.0/plugins/). It runs in-cluster, so you need to have cluster-admin access to the target API server.

## Setup

First, select the provider you wish to test (e.g. [digitalocean](digitalocean) or [AWS EKS](eks)) and follow the instructions
contained in that directory. Once you have access to the cluster and deployed the platform, double check that all pods are running
with `kubectl get pods --all-namespaces`.

## Run

Now that you have a cluster and CLI access to it, you can deploy the test suite on it and wait for it to finish running.

```bash
sonobuoy run -p tests/plugin.yml

# Run periodically to check if the suite has finished.
sonobuoy status

# When it reports conclusion, retrieve the test results and print them
sonobuoy results $(sonobuoy retrieve) --mode dump

# A nice HTML report can be generated by running
tests/generate-report.sh
```
